<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>List Users</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .table th, .table td {
            text-align: center;
        }

        .alert {
            margin-top: 20px;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .alert.show {
            opacity: 1;
            transform: translateY(0);
        }

        .alert.hide {
            opacity: 0;
            transform: translateY(30px);
        }

        .pagination {
            display: flex;
            justify-content: center;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <!-- Thông báo nếu có -->
    <div th:if="${message != null}" class="alert alert-primary" role="alert">
        <i th:text="${message}"></i>
    </div>

    <div class="container mt-5">
        <h1 class="text-center mb-4">User List</h1>

        <!-- Hiển thị danh sách -->
        <div th:if="${users != null}">
            <table class="table table-bordered table-striped table-hover">
                <thead class="thead-dark">
                    <tr>
                        <th>ID</th>
                        <th>Avatar</th>
                        <th>Full Name</th>
                        <th>Date</th>
                        <th>Address</th>
                        <th>Phone</th>
                        <th>Email</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Active</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="user : ${users}">
                        <td th:text="${user.userID}"></td>
                        <!-- Hiển thị ảnh đại diện -->
                        <td>
                            <img th:src="@{${user.image}}" alt="Avatar" class="avatar">
                        </td>
                        <td th:text="${user.fullName}"></td>
                        <td th:text="${#dates.format(user.date, 'dd/MM/yyyy')}"></td>
                        <td th:text="${user.address}"></td>
                        <td th:text="${user.phone}"></td>
                        <td th:text="${user.email}"></td>
                        <td th:text="${user.userName}"></td>
                        <!-- Thay đổi hiển thị vai trò -->
                        <td th:text="${user.role != null ? user.role.roleName : 'N/A'}"></td>
                        <!-- Thay thế active bằng biểu tượng -->
                        <td>
                            <a href="#" 
                               th:href="@{'/admin/user/toggleActive/' + ${user.userID}}"
                               th:class="${user.active ? 'text-success' : 'text-danger'}"
                               onclick="return toggleActive(this, ${user.userID})">
                                <i class="bi" 
                                   th:class="${user.active ? 'bi-check-circle' : 'bi-x-circle'}"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Hàm toggle trạng thái active
        function toggleActive(element, userID) {
            const url = '/admin/user/toggleActive/' + userID;
            fetch(url, {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    return response.text(); // Nhận thông báo từ server
                } else {
                    throw new Error('Không thể thay đổi trạng thái tài khoản.');
                }
            })
            .then(message => {
                alert(message); // Hiển thị thông báo thành công
                location.reload(); // Reload lại trang để cập nhật giao diện
            })
            .catch(error => {
                alert(error.message); // Hiển thị thông báo lỗi
            });

            return false; // Ngăn trình duyệt reload trang mặc định
        }

        // Hiệu ứng mờ dần cho thông báo
        window.onload = function() {
            const alertMessage = document.querySelector('.alert');
            if (alertMessage) {
                alertMessage.classList.add('show');
                setTimeout(() => {
                    alertMessage.classList.add('hide');
                }, 2000); // 2 giây
            }
        };
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
